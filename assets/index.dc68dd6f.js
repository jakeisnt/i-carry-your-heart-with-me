var f=Object.defineProperty;var u=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable;var m=(o,e,t)=>e in o?f(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,p=(o,e)=>{for(var t in e||(e={}))y.call(e,t)&&m(o,t,e[t]);if(u)for(var t of u(e))g.call(e,t)&&m(o,t,e[t]);return o};import{H as x}from"./vendor.3fdffd0c.js";const E=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}};E();const w=["sad","angry","disgust","fear","happy","surprise","neutral"],b=["happy","surprise","neutral"],c=Object.assign({},...Object.entries(p({},w)).map(([o,e])=>({[e]:[]}))),v={sad:"\u{1F614}",angry:"\u{1F621}",disgust:"\u{1F922}",fear:"\u{1F628}",happy:"\u{1F600}",surprise:"\u{1F62F}",neutral:"\u{1F610}"},h=o=>["angry, disgust"].includes(o)?"red":["happy","surprise"].includes(o)?"green":["sad","fear"].includes(o)?"blue":"black",a="|",C=[{text:"i carry your heart with me",expand:["(i carry it in",a,"my heart)"]},{text:"i am never without it",expand:["(anywhere",a,"i go you go,my dear;and whatever is done",a,"by only me is your doing,my darling)",a]},{text:[". . . . . . . . . . . . . . . . . . . . . . . . . . . i fear",a,"no fate"],expand:["(for ",{text:"you are my fate",emotion:"happy"}," ,my sweet)"]},{text:["i want",a,{emotion:"sad",text:"no world"}],expand:[" (for ",{text:"beautiful",emotion:"happy"}," you are my world, my true)",a]},{text:["and it's you are whatever a moon has always meant",a]},{text:["and whatever a sun will always sing is you",a]},{text:[a]},{text:[". . .",a]},{text:["here is ",{text:"the deepest secret",emotion:"sad"}," nobody knows",a],expand:["(here is the root of the root and the bud of the bud",a,"and the sky of the sky of ",{emotion:"surprise",text:"a tree called life"},";which grows",a,"higher than soul can hope or mind can hide)",a]},{text:["and this is ",{text:"the wonder",emotion:"surprise"}," that's keeping the stars apart",a]},{text:[". . .",a]},{text:"i carry your heart",expand:"(i carry it in my heart)"}],j=o=>{let e=document.createElement("p"),t=document.createElement("div");const i=n=>{n instanceof Array?n.forEach(r=>{if(r===a)e.appendChild(t),t=document.createElement("div");else if(r instanceof Object){let s=document.createElement("span");s.appendChild(document.createTextNode(r.text)),c[r.emotion].push(s),t.appendChild(s),s.classList.add("specialColor")}else t.appendChild(document.createTextNode(r))}):t.appendChild(document.createTextNode(n))};return o.forEach(({text:n,expand:r})=>{i(n),r&&i(r)}),e.appendChild(t),e},L=document.getElementById("text-container-inner");L.appendChild(j(C));const d=document.querySelector("#webcam"),l=document.querySelector("#view");document.querySelector("#debug");const O=l.getContext("2d"),$=o=>{const e=o.map(({score:i,emotion:n})=>i),t=Math.max(...e);return o[e.indexOf(t)].emotion},N=o=>{Object.keys(c).forEach(e=>{o===e?c[e].forEach(t=>{console.log(`adding ${e}`),t.classList.add(`emotion_${h(e)}`)}):c[e].forEach(t=>{console.log(`removing ${e}`),t.classList.remove(`emotion_${h(e)}`)})})},T=document.getElementById("emojiList"),q=o=>{const e=document.createElement("div");e.classList.add("singleEmoji"),e.appendChild(document.createTextNode(v[o])),T.appendChild(e)},A=o=>{let e=0,t=0,i=[];return o.forEach(r=>{i.push(`${r.emotion}: ${r.score}`),b.includes(r.emotion)?e+=r.score:t+=r.score}),e-t},B=new x({modelBasePath:"models/",backend:"webgl"});function I(){let o=0;async function e(){if(++o%30===0){const t=await B.detect(d);if(t.face.length===1){const i=t.face[0].emotion;console.log(`emotion score: ${A(i)}`);const n=$(i);console.log(`dominant emotion: ${n}`),N(n),q(n)}O.clearRect(0,0,l.width,l.height)}requestAnimationFrame(e)}e()}const P=()=>{console.log("starting video!"),window.navigator.mediaDevices.getUserMedia({video:!0}).then(o=>{d.srcObject=o,d.onloadedmetadata=e=>{d.play()},console.log("starting to play"),document.getElementById("cameraIcon").style.display="none",I()}).catch(()=>{console.log("missing webcam permissions")})};P();
